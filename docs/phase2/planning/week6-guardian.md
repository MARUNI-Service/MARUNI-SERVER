# Week 6: Guardian ë„ë©”ì¸ TDD ê°œë°œ ê³„íš

## ğŸ¯ Week 6 ëª©í‘œ

**Guardian(ë³´í˜¸ì) ë„ë©”ì¸ ì™„ì „ êµ¬í˜„**ì„ í†µí•´ MARUNIì˜ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì¸ **ì´ìƒì§•í›„ ê°ì§€ ì‹œ ë³´í˜¸ì ì•Œë¦¼** ì‹œìŠ¤í…œì„ ì™„ì„±í•©ë‹ˆë‹¤.

### ğŸ“‹ ì£¼ìš” êµ¬í˜„ ì‚¬í•­
- Guardian ì—”í‹°í‹° ë° Memberì™€ì˜ ê´€ê³„ ì„¤ì •
- ë³´í˜¸ì ë“±ë¡/ìˆ˜ì •/ì‚­ì œ/ì¡°íšŒ CRUD ì‹œìŠ¤í…œ
- ë³´í˜¸ìë³„ ì•Œë¦¼ ì„¤ì • ê´€ë¦¬ (ì•Œë¦¼ ë°©ë²•, ì‹œê°„, ê¸´ê¸‰ë„)
- Guardian-Member ë‹¤ëŒ€ë‹¤ ê´€ê³„ ì‹œìŠ¤í…œ
- ì™„ì „í•œ TDD ì ìš© (Red-Green-Refactor)

## ğŸ“… Week 6 ì¼ì • ê³„íš

### ğŸ”´ **Day 1-2: Red ë‹¨ê³„** - ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì‘ì„±
#### Day 1 (09-16 ì›”): Guardian ì—”í‹°í‹° TDD Red
- [ ] Guardian ì—”í‹°í‹° ê¸°ë³¸ êµ¬ì¡° ë° ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] Guardian-Member ê´€ê³„ ë§¤í•‘ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸
- [ ] GuardianRepository ê¸°ë³¸ CRUD ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸

#### Day 2 (09-17 í™”): Guardian Service TDD Red
- [ ] GuardianService í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸
- [ ] ë³´í˜¸ì ë“±ë¡/ìˆ˜ì •/ì‚­ì œ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸
- [ ] ì•Œë¦¼ ì„¤ì • ê´€ë¦¬ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸

### ğŸŸ¢ **Day 3-4: Green ë‹¨ê³„** - ìµœì†Œ êµ¬í˜„ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í†µê³¼
#### Day 3 (09-18 ìˆ˜): Guardian ì—”í‹°í‹° ë° Repository êµ¬í˜„
- [ ] Guardian, GuardianMemberMapping ì—”í‹°í‹° ìµœì†Œ êµ¬í˜„
- [ ] GuardianRepository, GuardianMemberMappingRepository êµ¬í˜„
- [ ] JPA ê´€ê³„ ë§¤í•‘ ë° ê¸°ë³¸ ì¿¼ë¦¬ êµ¬í˜„

#### Day 4 (09-19 ëª©): Guardian Service êµ¬í˜„
- [ ] GuardianService í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„
- [ ] CRUD ê¸°ëŠ¥ ìµœì†Œ êµ¬í˜„ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸

### ğŸ”µ **Day 5-6: Refactor ë‹¨ê³„** - ì½”ë“œ í’ˆì§ˆ í–¥ìƒ
#### Day 5 (09-20 ê¸ˆ): ì²´ê³„ì  ë¦¬íŒ©í† ë§
- [ ] í•˜ë“œì½”ë”© ì œê±° ë° ìƒìˆ˜í™”
- [ ] ì¤‘ë³µ ë¡œì§ ì¶”ì¶œ ë° ë©”ì„œë“œ ë¶„ë¦¬
- [ ] ì˜ˆì™¸ ì²˜ë¦¬ ë° ê²€ì¦ ë¡œì§ ê°œì„ 

#### Day 6 (09-21 í† ): Controller ë° ìµœì¢… í†µí•©
- [ ] GuardianController REST API êµ¬í˜„
- [ ] DTO ê³„ì¸µ êµ¬í˜„ ë° Bean Validation ì ìš©
- [ ] API ë¬¸ì„œí™” ë° í†µí•© í…ŒìŠ¤íŠ¸

## ğŸ—ï¸ Guardian ë„ë©”ì¸ ì•„í‚¤í…ì²˜ ì„¤ê³„

### DDD êµ¬ì¡°
```
com.anyang.maruni.domain.guardian/
â”œâ”€â”€ application/                 # Application Layer
â”‚   â”œâ”€â”€ dto/                    # Request/Response DTO
â”‚   â”‚   â”œâ”€â”€ GuardianRequestDto.java
â”‚   â”‚   â”œâ”€â”€ GuardianResponseDto.java
â”‚   â”‚   â””â”€â”€ GuardianMemberMappingDto.java
â”‚   â””â”€â”€ service/                # Application Service
â”‚       â””â”€â”€ GuardianService.java
â”œâ”€â”€ domain/                     # Domain Layer
â”‚   â”œâ”€â”€ entity/                 # Domain Entity
â”‚   â”‚   â”œâ”€â”€ GuardianEntity.java
â”‚   â”‚   â””â”€â”€ GuardianMemberMapping.java
â”‚   â””â”€â”€ repository/             # Repository Interface
â”‚       â”œâ”€â”€ GuardianRepository.java
â”‚       â””â”€â”€ GuardianMemberMappingRepository.java
â””â”€â”€ presentation/               # Presentation Layer
    â””â”€â”€ controller/             # REST API Controller
        â””â”€â”€ GuardianController.java
```

### í•µì‹¬ ì—”í‹°í‹° ì„¤ê³„

#### GuardianEntity
```java
@Entity
@Table(name = "guardian")
@Getter @NoArgsConstructor @AllArgsConstructor @Builder
public class GuardianEntity extends BaseTimeEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, length = 100)
    private String guardianName;

    @Column(nullable = false, unique = true, length = 150)
    private String guardianEmail;

    @Column(length = 20)
    private String guardianPhone;

    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private GuardianRelation relation; // FAMILY, FRIEND, CAREGIVER ë“±

    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private NotificationPreference notificationPreference; // PUSH, EMAIL, SMS, ALL

    @Column(nullable = false)
    private Boolean isActive = true;

    // ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œ
    public static GuardianEntity createGuardian(
        String name, String email, String phone,
        GuardianRelation relation, NotificationPreference preference) {
        return GuardianEntity.builder()
            .guardianName(name)
            .guardianEmail(email)
            .guardianPhone(phone)
            .relation(relation)
            .notificationPreference(preference)
            .isActive(true)
            .build();
    }

    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë©”ì„œë“œ
    public void updateNotificationPreference(NotificationPreference preference) {
        this.notificationPreference = preference;
    }

    public void deactivate() {
        this.isActive = false;
    }
}
```

#### GuardianMemberMapping (ë‹¤ëŒ€ë‹¤ ê´€ê³„)
```java
@Entity
@Table(name = "guardian_member_mapping")
@Getter @NoArgsConstructor @AllArgsConstructor @Builder
public class GuardianMemberMapping extends BaseTimeEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "guardian_id", nullable = false)
    private GuardianEntity guardian;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "member_id", nullable = false)
    private MemberEntity member;

    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private AlertLevel alertLevel; // LOW, MEDIUM, HIGH, EMERGENCY

    @Column(nullable = false)
    private Boolean isActive = true;

    // ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œ
    public static GuardianMemberMapping createMapping(
        GuardianEntity guardian, MemberEntity member, AlertLevel alertLevel) {
        return GuardianMemberMapping.builder()
            .guardian(guardian)
            .member(member)
            .alertLevel(alertLevel)
            .isActive(true)
            .build();
    }

    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    public void updateAlertLevel(AlertLevel alertLevel) {
        this.alertLevel = alertLevel;
    }
}
```

### Enum ì •ì˜
```java
public enum GuardianRelation {
    FAMILY("ê°€ì¡±"),
    FRIEND("ì¹œêµ¬"),
    CAREGIVER("ëŒë´„ì œê³µì"),
    NEIGHBOR("ì´ì›ƒ"),
    OTHER("ê¸°íƒ€");
}

public enum AlertLevel {
    LOW("ë‚®ìŒ"),
    MEDIUM("ë³´í†µ"),
    HIGH("ë†’ìŒ"),
    EMERGENCY("ê¸´ê¸‰");
}

public enum NotificationPreference {
    PUSH("í‘¸ì‹œì•Œë¦¼"),
    EMAIL("ì´ë©”ì¼"),
    SMS("SMS"),
    PUSH_EMAIL("í‘¸ì‹œ+ì´ë©”ì¼"),
    ALL("ëª¨ë“ ì•Œë¦¼");
}
```

## ğŸ§ª TDD í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ (ì´ 8ê°œ)

### Guardian Entity & Repository í…ŒìŠ¤íŠ¸ (4ê°œ)
1. **Guardian ìƒì„± í…ŒìŠ¤íŠ¸**: `createGuardian_shouldCreateValidGuardian`
2. **Guardian-Member ë§¤í•‘ í…ŒìŠ¤íŠ¸**: `createGuardianMemberMapping_shouldCreateValidMapping`
3. **í™œì„± Guardian ì¡°íšŒ í…ŒìŠ¤íŠ¸**: `findActiveGuardiansByMemberId_shouldReturnActiveGuardians`
4. **Guardian ë¹„í™œì„±í™” í…ŒìŠ¤íŠ¸**: `deactivateGuardian_shouldSetInactive`

### Guardian Service í…ŒìŠ¤íŠ¸ (4ê°œ)
5. **ë³´í˜¸ì ë“±ë¡ í…ŒìŠ¤íŠ¸**: `registerGuardian_shouldRegisterNewGuardian`
6. **íšŒì›ë³„ ë³´í˜¸ì ì¡°íšŒ í…ŒìŠ¤íŠ¸**: `getGuardiansByMemberId_shouldReturnMemberGuardians`
7. **ë³´í˜¸ì ì•Œë¦¼ ì„¤ì • ìˆ˜ì • í…ŒìŠ¤íŠ¸**: `updateNotificationPreference_shouldUpdatePreference`
8. **ë³´í˜¸ì-íšŒì› ë§¤í•‘ ìƒì„± í…ŒìŠ¤íŠ¸**: `createGuardianMemberMapping_shouldCreateMapping`

## ğŸ”— ë‹¤ë¥¸ ë„ë©”ì¸ê³¼ì˜ ì—°ë™ ì§€ì 

### Phase 3ì—ì„œ AlertRuleê³¼ ì—°ë™
```java
// AlertRuleì—ì„œ ì´ìƒì§•í›„ ê°ì§€ ì‹œ Guardianì—ê²Œ ì•Œë¦¼ ë°œì†¡
public interface GuardianNotificationService {
    void notifyGuardians(Long memberId, AlertLevel alertLevel, String alertMessage);
    List<GuardianEntity> getGuardiansByMemberAndAlertLevel(Long memberId, AlertLevel alertLevel);
}
```

### NotificationServiceì™€ ì—°ë™
```java
// Guardianì˜ NotificationPreferenceì— ë”°ë¥¸ ë‹¤ì¤‘ ì±„ë„ ì•Œë¦¼
public void sendGuardianAlert(GuardianEntity guardian, String alertMessage) {
    switch (guardian.getNotificationPreference()) {
        case PUSH -> notificationService.sendPushNotification(guardian.getId(), alertMessage);
        case EMAIL -> notificationService.sendEmail(guardian.getGuardianEmail(), alertMessage);
        case ALL -> sendMultiChannelAlert(guardian, alertMessage);
    }
}
```

## ğŸ“Š Week 6 ì™„ë£Œ ì‹œ ë‹¬ì„± ëª©í‘œ

```yaml
âœ… Guardian ë„ë©”ì¸: 100% TDD êµ¬í˜„
âœ… í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€: 100% (8ê°œ ì‹œë‚˜ë¦¬ì˜¤)
âœ… CRUD API: ì™„ì „í•œ REST API ì œê³µ
âœ… ê´€ê³„ ë§¤í•‘: Member-Guardian ë‹¤ëŒ€ë‹¤ ê´€ê³„ ì™„ì„±
âœ… ì•Œë¦¼ ì„¤ì •: ì„¸ë¶„í™”ëœ ì•Œë¦¼ ì±„ë„ ë° ë ˆë²¨ ê´€ë¦¬
âœ… Phase 2 ì§„í–‰ë¥ : 40% â†’ 70%ë¡œ í–¥ìƒ

ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜:
- ë³´í˜¸ì ì‹œìŠ¤í…œ ì™„ì„±ìœ¼ë¡œ ì‹¤ì œ ì„œë¹„ìŠ¤ ìš´ì˜ ê°€ëŠ¥
- ë‹¤ì–‘í•œ ì•Œë¦¼ ì±„ë„ë¡œ ìƒí™©ë³„ ì ì ˆí•œ ì•Œë¦¼ ì œê³µ
- ì„¸ë¶„í™”ëœ Alert Levelë¡œ ê¸´ê¸‰ë„ë³„ ì°¨ë“± ëŒ€ì‘
```

**Week 6 Guardian ë„ë©”ì¸ ì™„ì„± í›„, MARUNIëŠ” ì‹¤ì œ ë…¸ì¸ ëŒë´„ ì„œë¹„ìŠ¤ë¡œì„œì˜ í•µì‹¬ ê¸°ëŠ¥ì„ ëª¨ë‘ ê°–ì¶˜ ìƒíƒœê°€ ë©ë‹ˆë‹¤!** ğŸš€